<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>How Rick Finally Found His Szechuan Sauce - with Spring Cloud Stream</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.5.1/css/bulma.min.css">
</head>
<body>
<section class="hero is-primary is-bold">
    <div class="hero-body">
        <div class="container">
            <div class="columns">
                <div class="column is-narrow">
                    <figure class="image is-64x64">
                        <img src="img/spring-cloud.png">
                    </figure>
                </div>
                <div class="column">
                    <h1 class="title">
                        Spring Cloud Streams
                    </h1>
                    <h2 class="subtitle">
                        with Rick and Morty
                    </h2>
                </div>
            </div>
        </div>
    </div>
</section>
<nav class="level is-mobile" style="margin: 10px">
    <div class="level-item has-text-centered">
        <div>
            <p class="heading">Messages</p>
            <p class="title">0</p>
        </div>
    </div>
    <div class="level-item has-text-centered">
        <div>
            <p class="heading">Meeseeks</p>
            <p class="title">1</p>
        </div>
    </div>
    <div class="level-item has-text-centered">
        <div>
            <p class="heading">Szechuan Sauce</p>
            <p class="title">0</p>
        </div>
    </div>
</nav>
<div class="tile is-ancestor">
    <div class="tile is-4 is-vertical is-parent">
        <article class="tile is-child is-success">
            <table class="table is-fullwidth is-striped">
                <thead>
                <tr>
                    <th>Time</th>
                    <th>Message</th>
                </tr>
                </thead>
                <tbody id="RICK-chat-box">
                </tbody>
            </table>
        </article>
    </div>
    <div class="tile is-4 is-vertical is-parent">
        <article class="tile is-child is-success">
            <table class="table is-fullwidth is-striped">
                <thead>
                <tr>
                    <th>Time</th>
                    <th>Message</th>
                </tr>
                </thead>
                <tbody id="MEESEEKS-chat-box">
                </tbody>
            </table>
        </article>
    </div>
    <div class="tile is-4 is-vertical is-parent">
        <article class="tile is-child is-success">
            <table class="table is-fullwidth is-striped">
                <thead>
                <tr>
                    <th>Time</th>
                    <th>Message</th>
                </tr>
                </thead>
                <tbody id="MCDONALDS-chat-box">
                </tbody>
            </table>
        </article>
    </div>
</div>
<div class="tile is-ancestor">
    <div class="tile is-4 is-vertical is-parent">
        <article class="tile is-child notification is-success">
            <p class="title">Rick</p>
            <p class="subtitle"><i>I want that Mulan McNugget sauce, Morty. That's my series arc! If it takes nine
                seasons!</i></p>
            <figure class="image is-4by3">
                <img src="img/rick.gif">
            </figure>
        </article>
    </div>
    <div class="tile is-4 is-vertical is-parent">
        <article class="tile is-child notification is-info">
            <p class="title">Meeseeks</p>
            <p class="subtitle">Meeseeks are creatures created to serve a singular purpose for which they will go to
                any length to fulfill.
                After they serve their purpose, they expire and vanish into the air.</p>
            <figure class="image is-4by3">
                <img src="img/meeseeks.gif">
            </figure>
        </article>
    </div>
    <div class="tile is-4 is-vertical is-parent">
        <article class="tile is-child notification is-danger">
            <p class="title">McDonalds</p>
            <p class="subtitle">Szechuan Chicken McNugget Sauce was a dipping sauce for McDonald's Chicken McNuggets.
                Offered as a tie-in for the movie Mulan, the sauce was only available in 1998.</p>
            <figure class="image is-4by3">
                <img src="img/mcdonalds.gif">
            </figure>
        </article>
    </div>
</div>
<footer class="footer">
    <div class="container">
        <div class="content has-text-centered">
            <p>
                Created by
            </p>
            <p>
                <a href="https://www.twitter.com/dhubau" target="_blank" class="button is-primary">
                    <span class="icon">
                        <i class="fa fa-twitter"></i>
                    </span>
                    <span>Dieter Hubau</span>
                </a>
            </p>
            <p>
                <a href="https://www.github.com/Turbots/szechuan" target="_blank" class="button is-dark">
                    <span class="icon">
                        <i class="fa fa-github"></i>
                    </span>
                    <span>Source</span>
                </a>
            </p>
            <p>
                Hosted on <a href="https://run.pivotal.io" target="_blank">Pivotal Web Services</a>
            </p>
        </div>
    </div>
</footer>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="https://unpkg.com/vue"></script>
<script type="application/javascript">
    function checkTime(i) {
        return (i < 10) ? "0" + i : i;
    }

    function addMessage(characterId, message) {
        const chatMessages = $('#' + characterId);
        const date = new Date();
        const now = checkTime(date.getHours()) + ":" + checkTime(date.getMinutes()) + ":" + checkTime(date.getSeconds());
        chatMessages.append('<tr><td></td>' + now + '<td>' + message + '</td></tr>');
        $('#' + characterId + '-chat-box').scrollTop(chatMessages.height());
    }

    function onLoad(jQuery) {
        if (!!window.EventSource) {
            const source = new EventSource('/events');
            source.addEventListener('message', e => {
                const data = JSON.parse(e.data);
                addMessage(data.origin, data.message);
            }, false);
            source.addEventListener('open', e => console.log('Connection is open'), false);
            source.addEventListener('error', e => {
                if(e.readyState === EventSource.CLOSED) {
                    console.log('Connection was closed!');
                }
            }, false);
        } else {
            console.log('EventSource is not supported in this browser, try Chrome or Firefox!');
        }
    }

    $(document).ready(onLoad);
</script>
</body>
</html>
